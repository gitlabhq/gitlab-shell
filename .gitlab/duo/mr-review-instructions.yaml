---
# Custom instructions for GitLab Duo Code Review
# Based on GitLab's official code review guidelines

# References:
# - Field Standardisation in Observability: https://handbook.gitlab.com/handbook/engineering/architecture/design-documents/observability_field_standardisation/


# This file defines custom review criteria that will be applied to specific files
# during merge request reviews. Instructions are grouped by name and can target
# multiple file patterns using glob syntax.
instructions:
  - name: Log Field Standards
    fileFilters:
      - "**/*.go"
      - "!**/*_test.go"
    instructions: |
      Backend engineers should be complying with the new field standardisation in observability best practices
      1. For any log lines that have been altered:
        - Ask: "If you are adding or modifying fields that aren't service specific, please ensure that the field is defined within the LabKit Go Fields package"
        - Remind: "Common logging fields should be defined within the LabKit fields package and imported from there if they aren't service specific. Link: https://gitlab.com/gitlab-org/labkit/-/tree/master/fields?ref_type=heads"
      2. For any new fields being added to log messages:
        - Check to ensure that these fields are not dynamically generated
        - Remind: "We're aiming to standardise the fields that we emit across all of our services at GitLab through this approach. Read more about this in https://handbook.gitlab.com/handbook/engineering/architecture/design-documents/observability_field_standardisation/"
